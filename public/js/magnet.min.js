!function(a,b){"function"==typeof define&&define.amd?define(b(a)):"object"==typeof exports?module.exports=b(a):a.Magnet=b(a)}(this,function(a){"use strict";function b(a){if("string"==typeof a&&(a=document.querySelector(a)),a&&"object"==typeof a&&a.nodeType){var b={width:a.offsetWidth,height:a.offsetHeight},c=getComputedStyle(a),d={marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,borderLeft:0,borderRight:0,borderTop:0,borderBottom:0};for(var e in d){var f=c[e],g=parseFloat(f);d[e]=isNaN(g)?0:g}var h=d.marginLeft+d.marginRight,i=d.marginTop+d.marginBottom,j=d.paddingLeft+d.paddingRight,k=d.paddingTop+d.paddingBottom,l=d.borderLeft+d.borderRight,m=d.borderTop+d.borderBottom,n=b.borderBox="border-box"===c.boxSizing;return d.width&&(b.width=d.width+(n?0:j+l)),d.height&&(b.height=d.height+(n?0:k+m)),b.innerWidth=b.width-(j+l),b.innerHeight=b.height-(k+m),b.outerWidth=b.width+h,b.outerHeight=b.height+i,b}}function c(a){var b={x:parseInt(getComputedStyle(a).left,10),y:parseInt(getComputedStyle(a).top,10)};for(var c in b){var d=b[c];b[c]=isNaN(d)?0:d}return b}function d(a,b){return function(d,e){function i(a){return a.sortData[g]}for(var f=0;f<a.length;f++){var g=a[f],j=i(d),k=i(e);if(j>k||j<k){var l=void 0!==b[g]?b[g]:b,m=l?1:-1;return h.alphanumeric(j,k)*m}}return 0}}function e(a,b){var c=a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector;return c.call(a,b)}function f(a,b){function f(a,b){return a?function(c){return c.getAttribute(a)}:function(c){var d=c.querySelector(b);return d.textContent}}if("string"!=typeof b)return b;var c=b.trim().split(" "),d=c[0],e=d.match(/\[([^\]]+)]/);e=e&&e[1];var g,h,j=f(e,d),k=i[c[1]];return b=k?g=function(a){return k(j(a))}:h=function(a){return j(a)}}function k(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d}function l(a,b){this.element=a,this.defaults={duration:500,easing:"ease",itemStyle:{position:"absolute"},hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}},this.position={x:0,y:0},this.options=g.extend({},this.defaults),this._options(b),this._create()}function m(){}function n(){}function o(){}function p(){}function q(){}function r(a,b){this.element=a,this.defaults={containerStyle:{position:"relative"},initLayout:!0,resize:!0,resizeContainer:!0,sortAscending:!0,layoutMode:"grid"},this.options=g.extend({},this.defaults),this._options(b),this._create(),this.options.initLayout&&this.layout()}function t(a,b){$.fn[a]=function(c){if("string"==typeof c){var e,d=[].slice.call(arguments,1);return this.each(function(){var f=$.data(this,a);return f?f instanceof b&&!$.isFunction(f[c])||"_"===c.charAt(0)?void console.error("No such method '"+c+"' for '"+a+"' instance"):void(e=f[c].apply(f,d)):void console.error("Cannot call methods on '"+a+"' prior to initialization; attempted to call '"+c+"'")}),void 0!==e?e:this}return this.each(function(){var d=$.data(this,a);d?(d._options(c),d._init()):(d=new b(this,c),$.data(this,a,d))})}}var g={extend:function(a,b){for(var c in b)a[c]=b[c];return a},toArray:function(a){var b=[];return Array.isArray(a)?b=a:a instanceof s||a instanceof HTMLCollection||a instanceof NodeList?b=[].slice.call(a):b.push(a),b},isEmptyObject:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}},h={alphanumeric:function(a,b){return a>b?1:a<b?-1:0},downwardLeftToRight:function(a,b){return a.y-b.y||a.x-b.x},rightwardTopToBottom:function(a,b){return a.x-b.x||a.y-b.y}},i={parseInt:function(a){return parseInt(a,10)},parseFloat:function(a){return parseFloat(a)}},j={bind:function(a,b,c){a.addEventListener&&a.addEventListener(b,c,!1)},unbind:function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},emit:function(a,b){if(b.dispatchEvent){var c=document.createEvent("Event");c.initEvent(a,!0,!0),b.dispatchEvent(c)}}};k.prototype._contains=function(a){return this.x<=a.x&&this.y<=a.y&&this.x+this.width>=a.x+a.width&&this.y+this.height>=a.y+a.height},k.prototype._overlaps=function(a){return this.x<a.x+a.width&&this.x+this.width>a.x&&this.y<a.y+a.height&&this.y+this.height>a.y},k.prototype._fits=function(a){return this.width>=a.width&&this.height>=a.height},k.prototype._getRectsAround=function(a){if(!this._overlaps(a))return!1;var b=[];if(this.x+this.width>a.x+a.width){var c=new k(a.x+a.width,this.y,this.x+this.width-a.x-a.width,this.height);b.push(c)}if(this.y+this.height>a.y+a.height){var c=new k(this.x,a.y+a.height,this.width,this.y+this.height-a.y-a.height);b.push(c)}if(this.y<a.y){var c=new k(this.x,this.y,this.width,a.y-this.y);b.push(c)}if(this.x<a.x){var c=new k(this.x,this.y,a.x-this.x,this.height);b.push(c)}return b},l.prototype._create=function(){this._transition={property:{},clean:{},end:{}},this.sortData={},this.getSize(),this.css(this.options.itemStyle)},l.prototype._options=function(a){if(a)for(var b in a)this.options.hasOwnProperty(b)&&(this.options[b]=a[b])},l.prototype._remove=function(){this.css({display:""}),this.transition({to:this.options.hiddenStyle,end:{opacity:this._onRemoveTransitionEnd}})},l.prototype._onRemoveTransitionEnd=function(){this.element.parentNode.removeChild(this.element),j.emit("remove",this.element)},l.prototype._reveal=function(){delete this.hidden,this.css({display:""}),this.transition({from:this.options.hiddenStyle,to:this.options.visibleStyle,end:{opacity:this._onRevealTransitionEnd}})},l.prototype._onRevealTransitionEnd=function(){this.hidden||j.emit("reveal",this.element)},l.prototype._hide=function(){this.hidden=!0,this.css({display:""}),this.transition({from:this.options.visibleStyle,to:this.options.hiddenStyle,end:{opacity:this._onHideTransitionEnd}})},l.prototype._onHideTransitionEnd=function(){this.hidden&&(this.css({display:"none"}),j.emit("hide",this.element))},l.prototype._moveTo=function(a,b){this.setPosition(a,b),this.layoutPosition()},l.prototype._transitionTo=function(a,b){this.getPosition();var c={x:this.position.x,y:this.position.y};if(this.setPosition(a,b),a===c.x&&b===c.y&&!this._transition.ing)return void this.layoutPosition();var d={x:a-c.x,y:b-c.y};this.transition({to:{transform:"translate3d("+d.x+"px, "+d.y+"px, 0px)"},end:{transform:this.layoutPosition}})},l.prototype._onTransitionEnd=function(a){if(a.target===this.element){var b=this._transition,c=a.propertyName;delete b.property[c],g.isEmptyObject(b.property)&&this.disableTransition(),c in b.clean&&(this.element.style[c]="",delete b.clean[c]),c in b.end&&(b.end[c].call(this),delete b.end[c]),j.emit("transition",this.element)}},l.prototype._updateDelay=function(a){var b=isNaN(a)?0:a;this.options.delay=b},l.prototype._updateSortData=function(a){this.sortData.id=this.id,this.sortData.original=this.id,this.sortData.random=Math.random();for(var b in a){var c=a[b];this.sortData[b]=c(this.element,this)}},l.prototype.getSize=function(){this.size=b(this.element)},l.prototype.getPosition=function(){this.position=c(this.element)},l.prototype.setPosition=function(a,b){this.position.x=a,this.position.y=b},l.prototype.layoutPosition=function(){var a={top:this.position.y+"px",left:this.position.x+"px"};this.css(a),j.emit("layout",this.element)},l.prototype.handleEvent=function(a){switch(a.type){case"transitionend":this._onTransitionEnd(a)}},l.prototype.css=function(a){for(var b in a)this.element.style[b]=a[b]},l.prototype.transition=function(a){if(!parseFloat(this.options.duration))return void this.noTransition(a);var b=this._transition;for(var c in a.end)b.end[c]=a.end[c];for(var c in a.to)b.property[c]=!0,b.clean[c]=!0;a.from&&(this.css(a.from),this.getSize()),this.enableTransition(),this.css(a.to),this._transition.ing=!0},l.prototype.noTransition=function(a){this.css(a.to);var b={};for(var c in a.to)b[c]="";this.css(b);for(var c in a.end)a.end[c].call(this)},l.prototype.enableTransition=function(){this._transition.ing||(this.css({transitionProperty:"opacity, transform",transitionDuration:this.options.duration+"ms",transitionTimingFunction:this.options.easing,transitionDelay:this.options.delay+"ms"}),this.element.addEventListener("transitionend",this,!1))},l.prototype.disableTransition=function(){this.css({transitionProperty:"",transitionDuration:"",transitionTimingFunction:"",transitionDelay:""}),this.element.removeEventListener("transitionend",this,!1),this._transition.ing=!1},l.prototype.destroy=function(){this.css({position:"",top:"",left:"",opacity:"",transform:"",transition:""})},m.prototype._resetLayout=function(){this.x=0,this.y=0,this.maxX=0,this.maxY=0,this._resetSortDirection(),this._resetSpaces()},m.prototype._getItemPosition=function(a){var b=new k(this.x,this.y,a.size.outerWidth,a.size.outerHeight);this.spaces.some(function(a){if(a._fits(b))return this._placeInSpace(b,a),!0},this);var c=this.x,d=this.y;return this.maxX=Math.max(this.maxX,b.x+b.width),this.maxY=Math.max(this.maxY,b.y+b.height),{x:c,y:d}},m.prototype._getContainerSize=function(){return this.options.horizontal?{width:this.maxX}:{height:this.maxY}},m.prototype._resetSortDirection=function(){this.options.horizontal?(this.size.width=Number.POSITIVE_INFINITY,this.sortDirection="rightwardTopToBottom"):(this.size.height=Number.POSITIVE_INFINITY,this.sortDirection="downwardLeftToRight"),this.sorter=h[this.sortDirection]},m.prototype._resetSpaces=function(){var a=new k(this.x,this.y,this.size.width,this.size.height);this.spaces=[],this.spaces.push(a)},m.prototype._placeInSpace=function(a,b){this.x=a.x=b.x,this.y=a.y=b.y,this._splitSpace(a)},m.prototype._splitSpace=function(a){var b=[];this.spaces.forEach(function(c){var d=c._getRectsAround(a);d?b.push.apply(b,d):b.push(c)}),this.spaces=b,this._mergeSortSpaces()},m.prototype._mergeSortSpaces=function(){this._mergeSpaces(),this.spaces.sort(this.sorter)},m.prototype._mergeSpaces=function(){this.spaces.forEach(function(a){a&&this.spaces.forEach(function(b){b!==a&&a._contains(b)&&this._removeSpace(b)},this)},this)},m.prototype._removeSpace=function(a){this.spaces.some(function(b){var c=this.spaces.indexOf(a);if(b===a)return this.spaces.splice(c,1),!0},this)},n.prototype._resetLayout=function(){this.x=0,this.y=0,this.maxY=0},n.prototype._getItemPosition=function(a){0!==this.x&&this.x+a.size.outerWidth>this.size.width&&(this.x=0,this.y=this.maxY);var b=this.x,c=this.y;return this.x+=a.size.outerWidth,this.maxY=Math.max(this.maxY,this.y+a.size.outerHeight),{x:b,y:c}},n.prototype._getContainerSize=function(){return{height:this.maxY}},o.prototype._resetLayout=function(){this.x=0,this.y=0,this.maxX=0},o.prototype._getItemPosition=function(a){0!==this.y&&this.y+a.size.outerHeight>this.size.height&&(this.x=this.maxX,this.y=0);var b=this.x,c=this.y;return this.y+=a.size.outerHeight,this.maxX=Math.max(this.maxX,this.x+a.size.outerWidth),{x:b,y:c}},o.prototype._getContainerSize=function(){return{width:this.maxX}},p.prototype._resetLayout=function(){this.x=0},p.prototype._getItemPosition=function(a){this.y=0;var b=this.x,c=this.y;return this.x+=a.size.outerWidth,{x:b,y:c}},p.prototype._getContainerSize=function(){return{width:this.x}},q.prototype._resetLayout=function(){this.y=0},q.prototype._getItemPosition=function(a){this.x=0;var b=this.x,c=this.y;return this.y+=a.size.outerHeight,{x:b,y:c}},q.prototype._getContainerSize=function(){return{height:this.y}},r.prototype._create=function(){this.guid=0,this.sorters={},this._getSorters(),this.sortHistory=["original"],this.reloadItems(),this.css(this.options.containerStyle),this.options.resize&&this._bindResize()},r.prototype._options=function(a){a&&(this.options=g.extend(this.options,a))},r.prototype._init=function(){this.arrange()},r.prototype._itemize=function(a){var b=g.toArray(a);b=this._filterFindElements(b);var c=b.map(function(a,b){var c=new l(a,this.options);return c.id=++this.guid,c},this);return this._updateItemsSortData(c),c},r.prototype._mode=function(){switch(this._reloadLayout(),this.options.layoutMode){case"grid":g.extend(r.prototype,m.prototype);break;case"rows":g.extend(r.prototype,n.prototype);break;case"columns":g.extend(r.prototype,o.prototype);break;case"vertical":g.extend(r.prototype,q.prototype);break;case"horizontal":g.extend(r.prototype,p.prototype);break;default:throw new Error("No layout mode: "+this.options.layoutMode)}},r.prototype._filter=function(a){var b=this.options.filter||"*",c={matched:[],reveal:[],hide:[]};return a.forEach(function(a){var d=this._getFilterTest(a,b);d&&c.matched.push(a),d&&a.hidden?c.reveal.push(a):d||a.hidden||c.hide.push(a)},this),c},r.prototype._hideReveal=function(a){this._revealItems(a.reveal),this._hideItems(a.hide)},r.prototype._revealItems=function(a){if(this._emitCompleteOnItems("reveal",a),a&&a.length){var b=this._updateStagger();a.forEach(function(a,c){a._updateDelay(c*b),a._reveal()})}},r.prototype._hideItems=function(a){if(this._emitCompleteOnItems("hide",a),a&&a.length){var b=this._updateStagger();a.forEach(function(a,c){a._updateDelay(c*b),a._hide()})}},r.prototype._filterRevealAdded=function(a){var b=this._filter(a);return this._hideItems(b.hide),this.layoutItems(b.matched,!0),this._revealItems(b.matched),b.matched},r.prototype._sort=function(){var a=this.options.sortBy;if(a){var b=g.toArray(a);b=b.concat("original");var c=d(b,this.options.sortAscending);this.filteredItems.sort(c),0!==this.sortHistory.indexOf(a)&&this.sortHistory.unshift(a)}},r.prototype._layout=function(){var a=this._getIsInstant();this._mode(),this._resetLayout(),this._layoutItems(this.filteredItems,a),this._postLayout(),this._layoutInited=!0},r.prototype._layoutItems=function(a,b){var c=a.map(function(a){a.getSize();var c=this._getItemPosition(a);return c.item=a,c.instant=b,c},this);this._emitCompleteOnItems("layout",a),this._processLayoutQueue(c)},r.prototype._processLayoutQueue=function(a){a.forEach(function(a,b){this._positionItem(a.item,a.x,a.y,a.instant,b)},this)},r.prototype._positionItem=function(a,b,c,d,e){var f=this._updateStagger();d?a._moveTo(b,c):(a._updateDelay(e*f),a._transitionTo(b,c))},r.prototype._postLayout=function(){this._resizeContainer()},r.prototype._resizeContainer=function(){if(this.options.resizeContainer){var a=this._getContainerSize();a&&this._setContainerSize(a.width,a.height)}},r.prototype._setContainerSize=function(a,b){a?this.size.width=a:this.size.height=b,this.css({width:a+"px",height:b+"px"})},r.prototype._bindResize=function(){this.resizeBound||(j.bind(a,"resize",this),this.resizeBound=!0)},r.prototype._unbindResize=function(){this.resizeBound&&j.unbind(a,"resize",this),this.resizeBound=!1},r.prototype._onResize=function(a){function c(){b._resize(),delete b.timeout}var b=this;this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(c,100)},r.prototype._resize=function(){this.resizeBound&&this._resizeLayout()&&this.layout()},r.prototype._resizeLayout=function(){var a=b(this.element);return this.size!==a&&(this.getSize(),!0)},r.prototype._reloadLayout=function(){delete this.x,delete this.y,delete this.maxX,delete this.maxY,delete this.sortDirection,delete this.sorter,delete this.spaces,this._resetLayoutSize()},r.prototype._resetLayoutSize=function(){this.css({width:"",height:""}),this.getSize()},r.prototype._bindArrangeComplete=function(){function c(){for(var c in a)if(!a[c])return;b._onItemsComplete("arrange")}var a={layoutComplete:!1,hideComplete:!1,revealComplete:!1},b=this,d=[];for(var e in a)d.push(e);d.forEach(function(d){var e=function(){a[d]=!0,c.call(this),j.unbind(b.element,d,e)};j.bind(this.element,d,e)},this)},r.prototype._emitCompleteOnItems=function(a,b){function e(){d++,d===b.length&&c._onItemsComplete(a)}if(!b||!b.length)return void this._onItemsComplete(a);var c=this,d=0;b.forEach(function(b){var c=function(){e.call(this),j.unbind(b.element,a,c)};j.bind(b.element,a,c)})},r.prototype._onItemsComplete=function(a){j.emit(a+"Complete",this.element)},r.prototype._getIsInstant=function(){var a=void 0!==this.options.layoutInstant?this.options.layoutInstant:!this._layoutInited;return this._layoutInstant=a,a},r.prototype._getLayoutItems=function(a){return a.filter(function(a){return!a.hidden})},r.prototype._getFilterTest=function(a,b){return"function"==typeof b?b(a.element):e(a.element,b)},r.prototype._getSorters=function(){var a=this.options.sortData;for(var b in a){var c=a[b];this.sorters[b]=f(this.element.children,c)}},r.prototype._getElements=function(a){return a.map(function(a){return a.element})},r.prototype._getItemOption=function(a){var b=Math.floor(Math.random()*this.items.length),c=this.items[b];return c.options[a]},r.prototype._setItemsOptions=function(a){this.items.forEach(function(b){b._options(a)})},r.prototype._filterFindElements=function(a){return a.filter(function(a){if(a instanceof HTMLElement)return this.options.itemSelector?e(a,this.options.itemSelector)?a:void 0:a},this)},r.prototype._updateItemsSortData=function(a){a&&a.forEach(function(a){a._updateSortData(this.sorters)},this)},r.prototype._updateStagger=function(){var a=this.options.stagger;return a?(this.stagger=a,a):void(this.stagger=0)},r.prototype._removeItem=function(a){var b=this.items.indexOf(a);b!==-1&&this.items.splice(b,1)},r.prototype._noTransition=function(a,b){var c=this._getItemOption("duration");this._setItemsOptions({duration:0}),a.call(this,b),this._setItemsOptions({duration:c})},r.prototype.getSize=function(){this.size=b(this.element)},r.prototype.handleEvent=function(a){switch(a.type){case"resize":this._onResize(a)}},r.prototype.css=function(a){for(var b in a)this.element.style[b]=a[b]},r.prototype.addItems=function(a){var b=this._itemize(a);return b.length&&(this.items=this.items.concat(b)),b},r.prototype.append=function(a){if(a){var b=this.addItems(a),c=this._filterRevealAdded(b);this.filteredItems=this.filteredItems.concat(c)}},r.prototype.prepend=function(a){if(a){var b=this._itemize(a);this.items=b.concat(this.items),this._resetLayout();var c=this._filterRevealAdded(b);this.layoutItems(this.filteredItems),this.filteredItems=c.concat(this.filteredItems)}},r.prototype.insert=function(a){if(a){var b=this.addItems(a);b.forEach(function(a){this.element.appendChild(a.element)},this);var c=this._filter(b).matched,d=this._getItemOption("duration");b.forEach(function(a){a._options({duration:0})}),this.arrange(),b.forEach(function(a){a._options({duration:d})}),this._revealItems(c)}},r.prototype.remove=function(a){var b=this.getItems(a);this._emitCompleteOnItems("remove",b),b&&b.length&&(b.forEach(function(a){a._remove(),this._removeItem(a)},this),this.arrange())},r.prototype.reloadItems=function(){this.guid=0,this.items=this._itemize(this.element.children)},r.prototype.getItem=function(a){for(var b=0;b<this.items.length;b++){var c=this.items[b];if(c.element===a)return c}},r.prototype.getItems=function(a){var b=[];return a=g.toArray(a),a.forEach(function(a){var c=this.getItem(a);c&&b.push(c)},this),b},r.prototype.getItemsElements=function(){return this.items.map(function(a){return a.element})},r.prototype.getFilteredItems=function(){return this.filteredItems.map(function(a){return a})},r.prototype.getFilteredItemsElements=function(){return this.filteredItems.map(function(a){return a.element})},r.prototype.arrange=function(a){this._options(a),this._bindArrangeComplete();var b=this._getIsInstant(),c=this._filter(this.items);this.filteredItems=c.matched,b?this._noTransition(this._hideReveal,c):this._hideReveal(c),this._sort(),this._layout()},r.prototype.reveal=function(a){var b=this.getItems(a);this._revealItems(b);var c=this._getLayoutItems(this.items);this.filteredItems=c},r.prototype.hide=function(a){var b=this.getItems(a);this._hideItems(b);var c=this._getLayoutItems(this.items);this.filteredItems=c},r.prototype.layout=function(){return!this._layoutInited&&this.options.initLayout?void this.arrange():void this._layout()},r.prototype.layoutItems=function(a,b){this._layoutItems(a,b),this._postLayout()},r.prototype.updateSortData=function(a){var b;a?(a=g.toArray(a),b=this.getItems(a)):b=this.items,this._getSorters(),this._updateItemsSortData(b)},r.prototype.shuffle=function(){this.items.forEach(function(a){a.sortData.random=Math.random()}),this.options.sortBy="random",this._sort(),this._layout()},r.prototype.destroy=function(){this.items.forEach(function(a){a.destroy()}),this._unbindResize(),s&&s.removeData(this.element,this.constructor.namespace),this.css({position:"",width:"",height:""})};var s=a.jQuery;return s&&t("magnet",r),r});